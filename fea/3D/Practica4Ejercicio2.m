%Datos
P=10e3;A=10e-4;E=210e9;
NODOS=[4 4 3;   %NODO 1
       0 4 0;   %NODO 2
       0 4 6;   %NODO 3
       4 0 3;   %NODO 4
       8 -1 1]; %NODO 5

ELEMENTOS=[2 1;
           3 1;
           4 1;
           1 5];
%SALGO DEL PRIMER ELEMENTO Y VOY AL SEGUNDO

%Condiciones de borde
COND_BORDE=~~[1 1 1,0 0 0,0 0 0,0 0 0,0 0 0];
CARGA=[0 -P 0,0 0 0,0 0 0,0 0 0,0 0 0]';
LONGITUD=[sqrt(sum((NODOS(2,:)-NODOS(1,:)).^2)),...
          sqrt(sum((NODOS(3,:)-NODOS(1,:)).^2)),...
          sqrt(sum((NODOS(1,:)-NODOS(4,:)).^2)),...
          sqrt(sum((NODOS(1,:)-NODOS(5,:)).^2))];

COSENOS=[(NODOS(1,:)-NODOS(2,:))/LONGITUD(1);...
         (NODOS(1,:)-NODOS(3,:))/LONGITUD(2);...
         (NODOS(1,:)-NODOS(4,:))/LONGITUD(3);...
         (NODOS(5,:)-NODOS(1,:))/LONGITUD(4)];
     
MINDEXADO=[1 2 3 4 5 6;
           1 2 3 7 8 9;
           1 2 3 10 11 12;
           13 14 15 1 2 3];
 
K_GLOBAL=zeros(15,15);
for i=1:4
    K_LOCAL=(E*A/LONGITUD(i))*[1 -1;-1 1];
    T=[COSENOS(i,1) COSENOS(i,2) COSENOS(i,3) 0 0 0;
        0 0 0 COSENOS(i,1) COSENOS(i,2) COSENOS(i,3)];
    K_GLOBAL(MINDEXADO(i,:),MINDEXADO(i,:))=K_GLOBAL(MINDEXADO(i,:),MINDEXADO(i,:))+(T')*K_LOCAL*T;    
end


KREDUCIDA=K_GLOBAL(COND_BORDE,COND_BORDE);
DESP=(KREDUCIDA^-1)*CARGA(COND_BORDE);

U1=[COSENOS(1,1) COSENOS(1,2) COSENOS(1,3) 0 0 0;
        0 0 0 COSENOS(1,1) COSENOS(1,2) COSENOS(1,3)];
U2=[COSENOS(2,1) COSENOS(2,2) COSENOS(2,3) 0 0 0
        0 0 0 COSENOS(2,1) COSENOS(2,2) COSENOS(2,3)];
U3=[COSENOS(3,1) COSENOS(3,2) COSENOS(3,3) 0 0 0;
        0 0 0 COSENOS(3,1) COSENOS(3,2) COSENOS(3,3)];
U4=[COSENOS(4,1) COSENOS(4,2) COSENOS(4,3) 0 0 0;
        0 0 0 COSENOS(4,1) COSENOS(4,2) COSENOS(4,3)];
U1T=U1*[[0 0 0]';DESP];%SALGO DEL PRIMER ELEMNTO Y VOY AL SEGUNDO
U2T=U2*[[0 0 0]';DESP];
U3T=U3*[[0 0 0]';DESP];
U4T=U4*[DESP;[0 0 0]'];
SIGMA1=E*[-1/LONGITUD(1) 1/LONGITUD(1)]*U1T;
SIGMA2=E*[-1/LONGITUD(2) 1/LONGITUD(2)]*U2T;
SIGMA3=E*[-1/LONGITUD(3) 1/LONGITUD(3)]*U3T;
SIGMA4=E*[-1/LONGITUD(4) 1/LONGITUD(4)]*U4T;
SIGMA=[SIGMA1 SIGMA2 SIGMA3 SIGMA4];

%CALCULO IMPONIENDOLE EL DESPLAZAMIENTO
DESP_2=(K_GLOBAL([1 3],[1 3])^(-1))*(-K_GLOBAL([1 3],[2 4:15])*[-1.5171e-4 zeros(1,12)]');
DESP_2TOTAL=[DESP_2(1) -1.5171e-4 DESP_2(2)]';
U1T2=U1*[[0 0 0]';DESP_2TOTAL];%SALGO DEL PRIMER ELEMENTO Y VOY AL SEGUNDO
U2T2=U2*[[0 0 0]';DESP_2TOTAL];%ESTOS 4 SON LOS VECTORES QUE VOY A TRANSFORMAR
U3T2=U3*[[0 0 0]';DESP_2TOTAL];
U4T2=U4*[DESP_2TOTAL;[0 0 0]'];
SIGMA12=E*[-1/LONGITUD(1) 1/LONGITUD(1)]*U1T2;
SIGMA22=E*[-1/LONGITUD(2) 1/LONGITUD(2)]*U2T2;
SIGMA32=E*[-1/LONGITUD(3) 1/LONGITUD(3)]*U3T2;
SIGMA42=E*[-1/LONGITUD(4) 1/LONGITUD(4)]*U4T2;
SIGMA2=[SIGMA12 SIGMA22 SIGMA32 SIGMA42];

display(SIGMA);
display(SIGMA2);